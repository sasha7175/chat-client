<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Phaser Spine Chatroom</title>

  <style>
    html, body { height: 100%; margin: 0; background: #0d1117; color: #fff; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; overflow: hidden; }
    #game-container { width: 100%; height: 100%; }
    /* Rename UI above chat */
    #rename-ui { position: absolute; bottom: 70px; left: 50%; transform: translateX(-50%); z-index: 100; display: flex; gap: 8px; max-width: 90vw; align-items: center; }
    #rename-input { flex: 1; min-width: 150px; max-width: 400px; padding: 10px; border: 1px solid #444; background: #2a2a2a; color: #fff; border-radius: 6px; font-size: 16px; display: none; }
    #rename-input.active { display: block; }
    #rename-btn { padding: 10px 16px; color: #fff; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; font-weight: bold; width: auto; min-width: 80px; flex-shrink: 0; order: 1; }
    #rename-input { order: 2; }
    #rename-close-btn { padding: 8px 12px; color: #fff; background: #FF006E; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; font-weight: bold; width: auto; flex-shrink: 0; order: 3; }
    #rename-close-btn:hover { background: #C2185B; }
    #rename-close-btn.hidden { display: none; }
    #rename-confirm-btn { padding: 8px 12px; color: #fff; background: #00CC33; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; font-weight: bold; width: auto; flex-shrink: 0; order: 3; display: none; }
    #rename-confirm-btn.active { display: block; }
    #rename-confirm-btn:hover { background: #009933; }
    #rename-ui.disabled { display: none; pointer-events: none; opacity: 0.5; }
    #rename-btn:disabled { background: #666; cursor: not-allowed; opacity: 0.5; }
    #rename-input:disabled { opacity: 0.5; cursor: not-allowed; }
    /* This UI overlays the game canvas */
    #chat-ui { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); z-index: 100; display: flex; gap: 8px; max-width: 90vw; }
    #chat-input { flex: 1; min-width: 150px; max-width: 400px; padding: 10px; border: 1px solid #444; background: #2a2a2a; color: #fff; border-radius: 6px; font-size: 16px; }
    #chat-anim, #chat-send { padding: 10px 16px; color: #fff; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; font-weight: bold; width: auto; min-width: 64px; flex-shrink: 0; }
    /* Name picker modal */
    #name-picker { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); display: flex; align-items: center; justify-content: center; z-index: 1000; }
    #name-picker.hidden { display: none; }
    #name-picker-dialog { background: #1a1a1a; border: 2px solid #444; border-radius: 12px; padding: 40px; text-align: center; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.8); }
    #name-picker-dialog h2 { margin: 0 0 20px 0; font-size: 24px; }
    #name-picker-dialog input { width: 200px; padding: 12px; margin: 10px 0; border: 1px solid #444; background: #2a2a2a; color: #fff; border-radius: 6px; font-size: 16px; }
    #name-picker-dialog select { width: 220px; padding: 12px; margin: 10px 0; border: 1px solid #444; background: #2a2a2a; color: #fff; border-radius: 6px; font-size: 16px; }
    #name-picker-dialog label { display: block; margin-top: 15px; font-size: 14px; color: #aaa; }
    #name-picker-dialog button { margin-top: 20px; padding: 12px 32px; background: #00D9FF; color: #000; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; font-weight: bold; }
    #name-picker-dialog button:hover { background: #00B8CC; }
    /* Loading screen overlay */
    #loading-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #0d1117; display: flex; align-items: center; justify-content: center; z-index: 2000; }
    #loading-overlay.hidden { display: none; }
    #loading-content { text-align: center; }
    #loading-spinner { width: 60px; height: 60px; border: 4px solid #444; border-top-color: #00D9FF; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 20px; }
    @keyframes spin { to { transform: rotate(360deg); } }
    #loading-text { font-size: 18px; color: #aaa; margin-bottom: 10px; }
    #loading-status { font-size: 14px; color: #666; }
    /* Mobile touch controls */
    #mobile-joystick { position: fixed; bottom: 120px; left: 30px; width: 120px; height: 120px; z-index: 99; display: none; }
    #joystick-base { width: 120px; height: 120px; border-radius: 50%; background: rgba(255, 255, 255, 0.1); border: 3px solid rgba(255, 255, 255, 0.3); position: absolute; }
    #joystick-stick { width: 50px; height: 50px; border-radius: 50%; background: rgba(255, 255, 255, 0.6); position: absolute; top: 35px; left: 35px; transition: all 0.1s; }
    @media (pointer: coarse) { #mobile-joystick { display: block; } }
  </style>

  <!-- Color themes for buttons -->
  <script>
    const colorThemes = [
      { emote: { bg: '#FF006E', hover: '#C2185B' }, send: { bg: '#00D9FF', hover: '#00B8CC' }, rename: { bg: '#9D4EDD', hover: '#7209B7' } },
      { emote: { bg: '#9D4EDD', hover: '#7209B7' }, send: { bg: '#3A86FF', hover: '#1E90FF' }, rename: { bg: '#FF006E', hover: '#C2185B' } },
      { emote: { bg: '#FF6B35', hover: '#F7931E' }, send: { bg: '#00A8CC', hover: '#0085B6' }, rename: { bg: '#00FF88', hover: '#00CC66' } },
      { emote: { bg: '#F72585', hover: '#D61E7E' }, send: { bg: '#00D4FF', hover: '#00A8CC' }, rename: { bg: '#FFAA00', hover: '#FF8800' } },
      { emote: { bg: '#FF10F0', hover: '#E700CC' }, send: { bg: '#00CC33', hover: '#009933' }, rename: { bg: '#00D9FF', hover: '#00B8CC' } }
    ];

    function applyRandomTheme() {
      const theme = colorThemes[Math.floor(Math.random() * colorThemes.length)];
      const style = document.createElement('style');
      style.textContent = `
        #chat-anim { background: ${theme.emote.bg}; }
        #chat-anim:hover { background: ${theme.emote.hover}; }
        #chat-send { background: ${theme.send.bg}; }
        #chat-send:hover { background: ${theme.send.hover}; }
        #rename-btn { background: ${theme.rename.bg}; }
        #rename-btn:hover { background: ${theme.rename.hover}; }
      `;
      document.head.appendChild(style);
    }

    // Apply theme before game loads
    applyRandomTheme();
  </script>

  <!-- Load libraries FIRST, in order -->
  <script src="./lib/phaser.min.js"></script>
  <script src="./lib/spine-phaser.min.js"></script>
  <script src="./lib/fuse.min.js"></script>
  <!-- Leo Profanity: word filtering library (local files) -->
  <script src="./lib/leo-profanity-dict.js"></script>
  <script src="./lib/leo-profanity.js"></script>

  <!-- Utility: Wait for all libraries to load before starting the game -->
  <script>
    function checkLibsReady() {
      const hasPhaser = typeof Phaser !== 'undefined';
      const hasFuse = typeof Fuse !== 'undefined';
      
      if (hasPhaser && hasFuse) {
        return true;
      }
      return false;
    }
    
    // Check every 100ms, max 5 seconds
    let attempts = 0;
    const checker = setInterval(() => {
      attempts++;
      if (checkLibsReady() || attempts > 50) {
        clearInterval(checker);
        // Start the game module after libraries are ready
        import('./game.js').catch(err => {
          console.error('Failed to load game.js:', err);
        });
      }
    }, 100);
  </script>
</head>
<body>
  <div id="game-container"></div>
  <div id="loading-overlay">
    <div id="loading-content">
      <div id="loading-spinner"></div>
      <div id="loading-status">Connecting to server...</div>
    </div>
  </div>
  <div id="rename-ui">
    <button id="rename-btn">Rename</button>
    <input type="text" id="rename-input" placeholder="Rename yourself... (once)" />
    <button id="rename-close-btn">✕</button>
    <button id="rename-confirm-btn">✓</button>
  </div>
  <div id="chat-ui">
    <button id="chat-anim" title="Play Animation">Emote</button>
    <input type="text" id="chat-input" placeholder="Type into here..." />
    <button id="chat-send">Send</button>
  </div>
  <div id="mobile-joystick">
    <div id="joystick-base"></div>
    <div id="joystick-stick"></div>
  </div>

